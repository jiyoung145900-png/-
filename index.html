<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOBLESSE | 코스 및 가격표</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* --- 1. 노블레스 테마 기본 설정 --- */
        :root {
            --noble-gold: #c5a059;
            --noble-dark: #1a1a1a;
            --noble-navy: #0a192f;
            --noble-white: #ffffff;
            --noble-gray: #f4f4f4;
        }

        body { 
            font-family: 'Pretendard', 'Malgun Gothic', serif;
            margin: 0; padding: 0; 
            display: flex; justify-content: center; 
            background-color: #050505; 
            color: var(--noble-dark);
        }
        
        .phone-container {
            position: relative;
            display: flex;
            justify-content: center;
            padding: 20px;
        }

        .phone-frame {
            width: 600px;
            height: 1100px; 
            overflow-y: auto; 
            background-color: var(--noble-navy);
            box-shadow: 0 0 50px rgba(197, 160, 89, 0.2);
            border: 4px solid var(--noble-gold);
            border-radius: 30px;
            padding: 40px 30px; 
            box-sizing: border-box;
            position: relative;
        }

        /* 배경 장식 */
        #main-background {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; 
            opacity: 0.15; 
            background-image: url('https://www.transparenttextures.com/patterns/dark-matter.png'); 
            background-size: cover;
        }
        
        #course-list-view, #detail-view, #admin-view { position: relative; z-index: 1; }

        /* --- 2. 프리미엄 버튼 스타일 --- */
        #control-buttons {
            position: absolute;
            top: 30px; right: -180px; 
            z-index: 1001; 
            display: flex; flex-direction: column; gap: 12px; width: 160px;
        }

        #control-buttons button {
            padding: 12px; border: 1px solid var(--noble-gold);
            border-radius: 4px; cursor: pointer; font-size: 0.9em;
            width: 100%; font-weight: bold;
            background-color: var(--noble-dark); color: var(--noble-gold);
            transition: 0.3s;
        }

        #control-buttons button:hover {
            background-color: var(--noble-gold); color: var(--noble-dark);
        }

        #save-admin-changes-btn { background-color: #2e7d32 !important; color: white !important; display: none; border: none !important; }
        .admin-mode-active { background-color: #c62828 !important; color: white !important; border: none !important; }
        .detail-only { display: none; }
        
        /* --- 3. 코스 목록 스타일 --- */
        .course-list-header { 
            color: var(--noble-gold); text-align: center; 
            font-size: 2em; margin-top: 40px; margin-bottom: 50px;
            letter-spacing: 5px; border-bottom: 1px solid var(--noble-gold);
            padding-bottom: 20px;
        }

        .course-item { 
            background: linear-gradient(145deg, #16253d, #0a192f);
            border: 1px solid rgba(197, 160, 89, 0.3); 
            padding: 25px; margin-bottom: 20px; border-radius: 5px; 
            display: flex; justify-content: space-between; align-items: center; 
            cursor: pointer; transition: 0.3s;
        }

        .course-item:hover { border-color: var(--noble-gold); transform: translateY(-3px); }
        .course-item .course-title { font-size: 1.4em; font-weight: bold; color: var(--noble-gold); }
        .course-item .course-info { text-align: right; color: #ccc; }
        .course-item .course-price { font-size: 1.3em; font-weight: 800; color: #fff; display: block; margin-top: 5px; }
        
        /* --- 4. 상세 뷰 및 옵션 (럭셔리 카드) --- */
        #detail-view { display: none; color: white; }
        #detail-view h3 { color: var(--noble-gold); font-size: 1.8em; text-align: center; margin-bottom: 5px; }
        .option-item { 
            background: rgba(255,255,255,0.05); padding: 15px; 
            margin-bottom: 10px; border-radius: 4px; display: flex; align-items: center;
        }
        .option-item input[type="checkbox"] { accent-color: var(--noble-gold); width: 20px; height: 20px; margin-right: 15px; }
        
        #total-display { 
            background-color: var(--noble-gold); color: var(--noble-dark);
            padding: 20px; margin-top: 30px; border-radius: 4px;
            display: flex; justify-content: space-between; align-items: center; font-weight: bold;
        }
        #current-total-price { font-size: 1.8em; }

        /* --- 5. 관리자 모드 --- */
        #admin-view { display: none; background-color: #fff; padding: 20px; border-radius: 10px; color: #333; }
        .admin-course-item { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; background: #f9f9f9; }
        .admin-course-item input { width: 100%; padding: 10px; margin: 5px 0; box-sizing: border-box; }

        /* --- 6. 견적서 모달 (명품 보증서 스타일) --- */
        .modal-overlay { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center; 
        }
        .modal-content { 
            background: var(--noble-navy); color: white; padding: 40px; border: 2px solid var(--noble-gold);
            width: 90%; max-width: 450px; position: relative;
        }
        .quote-header h3 { color: var(--noble-gold); text-align: center; letter-spacing: 3px; border-bottom: 1px solid var(--noble-gold); padding-bottom: 20px; }
        .final-total { border-top: 1px solid var(--noble-gold); margin-top: 20px; padding-top: 20px; text-align: center; }
        .final-total .total-price { font-size: 2.5em; color: var(--noble-gold); font-weight: bold; }
        
        .action-btn { width: 100%; padding: 15px; margin-top: 10px; cursor: pointer; font-weight: bold; border: none; }
        #back-btn { background: #333; color: white; }
    </style>
</head>
<body>

<div class="phone-container">
    <div class="phone-frame" id="phone-frame-capture">
        <div id="main-background"></div>
        
        <div id="course-list-view">
            <h3 class="course-list-header">NOBLESSE MENU</h3>
            <div id="course-items-container"></div>
        </div>

        <div id="detail-view">
            <h3 id="detail-title-selected"></h3>
            <p style="text-align: center; color: #aaa; margin-bottom: 30px;">
                [ <span id="detail-time-selected"></span> | Basic ₩<span id="detail-price-selected-val"></span> ]
            </p>
            <div id="options-list"></div>
            <div id="total-display">
                <span>ESTIMATED TOTAL</span>
                <span id="current-total-price">₩ 0</span>
            </div>
            <button id="back-btn" class="action-btn" onclick="showCourseList()">BACK TO MENU</button>
        </div>

        <div id="admin-view">
            <h3 style="border-bottom: 2px solid var(--noble-gold); padding-bottom: 10px;">SYSTEM MANAGEMENT</h3>
            <div id="admin-course-editor"></div>
            <button onclick="addNewCourse(event)" style="width:100%; padding:15px; background:var(--noble-gold); color:white; border:none; margin-top:10px; cursor:pointer;">+ ADD NEW COURSE</button>
        </div>
    </div>
    
    <div id="control-buttons">
        <button id="toggle-admin-btn" onclick="toggleAdminMode()">SYSTEM EDIT</button>
        <button id="save-admin-changes-btn" onclick="saveAdminChanges()">SAVE CHANGES</button>
        <button id="capture-list-btn" onclick="captureFrameAsPNG('phone-frame-capture')">CAPTURE LIST</button>
        <button id="show-quote-btn" class="detail-only" onclick="showFinalQuote()">VIEW QUOTE</button>
        <button id="capture-quote-btn" class="detail-only" onclick="captureQuoteAsPNG()">CAPTURE QUOTE</button>
        <button id="save-options-btn" class="detail-only" onclick="saveUserSelectionsManually()">SAVE SELECTION</button>
    </div>
</div>

<div id="final-quote-modal" class="modal-overlay">
    <div class="modal-content" id="modal-capture-target">
        <div class="quote-header"><h3>NOBLESSE CERTIFICATE</h3></div>
        <div id="quote-details-content" style="margin: 20px 0; line-height: 1.8;"></div>
        <div class="final-total">
            <p style="font-size: 0.9em; color: #aaa;">TOTAL AMOUNT</p>
            <div class="total-price">₩ <span id="modal-total-price">0</span></div>
        </div>
        <button id="modal-close-btn" class="action-btn" style="background:var(--noble-gold); color:var(--noble-dark);" onclick="closeFinalQuoteModal()">CONFIRM</button>
    </div>
</div>

<script>
    // --- 데이터 및 초기화 (기존 로직 유지) ---
    const INITIAL_COURSES = {
        'black': { title: 'BLACK', time: '1시간', basePrice: 100000, options: [{name: 'Signature Care', price: 30000}, {name: 'Premium Oil', price: 20000}] },
        'gold': { title: 'GOLD', time: '2시간', basePrice: 200000, options: [{name: 'All-inclusive', price: 50000}] }
    };
    
    let coursesData; 
    let currentSelectedCourseKey = null;
    let isEditingMode = false;
    let newCourseIndex = 0;

    const formatPrice = (price) => price.toLocaleString('ko-KR');

    function loadCoursesData() {
        const savedData = localStorage.getItem('nobleCoursesData');
        coursesData = savedData ? JSON.parse(savedData) : INITIAL_COURSES;
    }
    
    function saveCoursesData() {
        localStorage.setItem('nobleCoursesData', JSON.stringify(coursesData));
    }

    // --- 뷰 렌더링 ---
    function renderCourseList() {
        document.getElementById('course-list-view').style.display = 'block';
        document.getElementById('detail-view').style.display = 'none';
        document.getElementById('admin-view').style.display = 'none';
        document.getElementById('save-admin-changes-btn').style.display = 'none';
        
        const container = document.getElementById('course-items-container');
        let html = '';
        for (const key in coursesData) {
            const course = coursesData[key];
            html += `
                <div class="course-item" onclick="selectCourse('${key}')">
                    <div class="course-title">${course.title}</div>
                    <div class="course-info">
                        <span>${course.time}</span>
                        <span class="course-price">₩ ${formatPrice(course.basePrice)}</span>
                    </div>
                </div>`;
        }
        container.innerHTML = html;
        toggleDetailButtons(false);
    }

    function selectCourse(key) {
        currentSelectedCourseKey = key;
        const course = coursesData[key];
        document.getElementById('course-list-view').style.display = 'none';
        document.getElementById('detail-view').style.display = 'block';
        document.getElementById('detail-title-selected').textContent = course.title + ' COURSE';
        document.getElementById('detail-time-selected').textContent = course.time;
        document.getElementById('detail-price-selected-val').textContent = formatPrice(course.basePrice);
        
        renderOptions(course.options);
        toggleDetailButtons(true);
    }

    function renderOptions(options) {
        const list = document.getElementById('options-list');
        let html = '<h4 style="color:var(--noble-gold); margin-bottom:15px;">ADDITIONAL OPTIONS</h4>';
        options.forEach((opt, idx) => {
            html += `
                <div class="option-item">
                    <input type="checkbox" id="opt-${idx}" data-price="${opt.price}" onchange="updateTotalPrice()">
                    <label for="opt-${idx}">${opt.name} (+₩${formatPrice(opt.price)})</label>
                </div>`;
        });
        list.innerHTML = html;
        updateTotalPrice(false);
    }

    function updateTotalPrice(shouldSave = true) {
        const course = coursesData[currentSelectedCourseKey];
        let total = course.basePrice;
        document.querySelectorAll('#options-list input[type="checkbox"]:checked').forEach(cb => {
            total += parseInt(cb.dataset.price);
        });
        document.getElementById('current-total-price').textContent = '₩ ' + formatPrice(total);
    }

    function toggleAdminMode() {
        isEditingMode = !isEditingMode;
        const adminView = document.getElementById('admin-view');
        const listView = document.getElementById('course-list-view');
        const btn = document.getElementById('toggle-admin-btn');
        const saveBtn = document.getElementById('save-admin-changes-btn');

        if(isEditingMode) {
            adminView.style.display = 'block';
            listView.style.display = 'none';
            btn.textContent = 'CANCEL';
            btn.classList.add('admin-mode-active');
            saveBtn.style.display = 'block';
            renderAdminEditor();
        } else {
            renderCourseList();
            btn.textContent = 'SYSTEM EDIT';
            btn.classList.remove('admin-mode-active');
        }
    }

    function renderAdminEditor() {
        const container = document.getElementById('admin-course-editor');
        let html = '';
        for (const key in coursesData) {
            const course = coursesData[key];
            html += `
                <div class="admin-course-item" data-key="${key}">
                    <input type="text" data-field="title" value="${course.title}" placeholder="Course Name">
                    <input type="text" data-field="time" value="${course.time}" placeholder="Time">
                    <input type="number" data-field="basePrice" value="${course.basePrice}" placeholder="Base Price">
                    <button onclick="deleteCourse(event, '${key}')" style="background:red; color:white; border:none; padding:5px; width:100%; cursor:pointer;">DELETE COURSE</button>
                </div>`;
        }
        container.innerHTML = html;
    }

    function saveAdminChanges() {
        const items = document.querySelectorAll('.admin-course-item');
        const newData = {};
        items.forEach(item => {
            const key = item.dataset.key;
            newData[key] = {
                title: item.querySelector('[data-field="title"]').value,
                time: item.querySelector('[data-field="time"]').value,
                basePrice: parseInt(item.querySelector('[data-field="basePrice"]').value),
                options: coursesData[key].options // 기존 옵션 유지 (간소화)
            };
        });
        coursesData = newData;
        saveCoursesData();
        alert("System Updated.");
        toggleAdminMode();
    }

    function showFinalQuote() {
        const course = coursesData[currentSelectedCourseKey];
        let total = course.basePrice;
        let optsHtml = '<ul>';
        document.querySelectorAll('#options-list input[type="checkbox"]:checked').forEach(cb => {
            const price = parseInt(cb.dataset.price);
            total += price;
            optsHtml += `<li>${cb.nextElementSibling.textContent}</li>`;
        });
        optsHtml += '</ul>';

        document.getElementById('quote-details-content').innerHTML = `
            <p><strong>COURSE:</strong> ${course.title}</p>
            <p><strong>DURATION:</strong> ${course.time}</p>
            <p><strong>OPTIONS:</strong> ${optsHtml}</p>
        `;
        document.getElementById('modal-total-price').textContent = formatPrice(total);
        document.getElementById('final-quote-modal').style.display = 'flex';
    }

    function closeFinalQuoteModal() { document.getElementById('final-quote-modal').style.display = 'none'; }
    function showCourseList() { renderCourseList(); }
    function toggleDetailButtons(show) {
        document.querySelectorAll('.detail-only').forEach(b => b.style.display = show ? 'block' : 'none');
    }

    // 캡처 기능 (데이지 기능 계승)
    function captureFrameAsPNG(id) {
        html2canvas(document.getElementById(id), { scale: 2, backgroundColor: '#0a192f' }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'NOBLESSE_LIST.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    function captureQuoteAsPNG() {
        html2canvas(document.getElementById('modal-capture-target'), { scale: 2, backgroundColor: '#0a192f' }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'NOBLESSE_QUOTE.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    window.onload = () => { loadCoursesData(); renderCourseList(); };
</script>
</body>
</html>
